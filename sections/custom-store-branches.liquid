{%- style -%}
.custom-branch__header {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
}

.custom-branch__body {
    display: flex;
    gap: 20px;
    justify-content: flex-start;
    align-items: flex-start;
    flex-wrap: wrap;
}

.custom-branch__items {
    flex: 1 0 100%;
    text-align:center;
}

.custom-branch__items_wrapper{
    position: relative;
    padding: 1rem;
    background: var(--zekoki-primary);
    border-radius: 1rem;
}

.custom-branch__items_wrapper h2 {
    background: var(--zekoki-primary);
    color: var(--zekoki-white);
    padding: 20px;
    width:100%;
    margin: 0 !important;
}

@media screen and (min-width: 750px) {
    .custom-branch__items {
        flex: 0 0 30%;
    }
}

.is-hidden {
    display: none;
}
{%- endstyle -%}

<section
  class="page-width custom-branch__section scroll-trigger animate--slide-in"
  style="
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  <div class="custom-branch__container">

    <div class="custom-branch__header">
      <div class="custom_branch__header--container">
        <h2 class="h1 title">{{ section.settings['custom-branch__title'] }}</h2>
      </div>
      <div class="custom_branch__header--container">
        <p>{{ section.settings['custom-branch__description'] }}</p>
      </div>
    </div>

    {% assign branch_limit = section.settings.branch_limit %}
    {% assign all_branches = shop.metaobjects.zekoki_store_branches.values %}
    {% assign branches = all_branches | slice: 0, branch_limit %}

    <div class="custom-branch__body">

      {% for branch in branches %}
        <div class="custom-branch__items branch-item">
          <div class="custom-branch__items_wrapper">
            {% if branch.photo != blank %}
              <img src="{{ branch.photo | image_url }}" alt="{{ branch.title }}">
            {% endif %}
            <h3 style="color: var(--zekoki-white);">{{ branch.title }}</h3>
          </div>

          <p>{{ branch.location }}</p>

          <a
            href="
              {% if page.handle == 'statins' %}
                zekoki-store-branches/{{ branch.system.handle }}
              {% else %}
                pages/zekoki-store-branches/{{ branch.system.handle }}
              {% endif %}
            "
            class="button button--primary"
          >
            Branch Details
          </a>
        </div>
      {% endfor %}

    </div>

    {% if branch_limit > 9 %}
      <div style="text-align:center; margin-top:30px;">
        <button id="loadMoreBtn" class="button button--secondary">
          Load More
        </button>
      </div>
    {% endif %}

  </div>
</section>

{% if branch_limit > 9 %}
<script>
document.addEventListener("DOMContentLoaded", function() {

  const items = document.querySelectorAll(".branch-item");
  const loadMoreBtn = document.getElementById("loadMoreBtn");

  let currentlyVisible = {{ branch_limit }};
  const loadStep = 6;

  if (!loadMoreBtn) return;

  loadMoreBtn.addEventListener("click", function() {

    let nextItems = currentlyVisible + loadStep;

    items.forEach((item, index) => {
      if (index < nextItems) {
        item.style.display = "block";
      }
    });

    currentlyVisible = nextItems;

    if (currentlyVisible >= items.length) {
      loadMoreBtn.style.display = "none";
    }

  });

});
</script>
{% endif %}
